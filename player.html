<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>StoryWays Player</title>
<style>
body {
  margin: 0;
  background: #0d0d0f;
}
</style>
</head>
<body>

<!-- ğŸµ í”Œë ˆì´ì–´ ë³¸ì²´ -->
<tistory-yt-audio-player style="display:block;max-width:720px;margin:0 auto;padding:10px;">
  <script type="application/json">
  {
    "urls": [
      "https://youtu.be/oDhOws90Nlg?si=m0I5DEzPyalD4Apv",
      "https://youtu.be/DQAqY3767wA?si=r_EUcTkMRZAsmc8-",
      "https://youtu.be/q_4-m8Z2p7I?si=MqbbiluvU_PPIOrZ",
      "https://youtu.be/yHsXVpsSc3s?si=DpN1Iq9PN2L_eYHS",
      "https://youtu.be/iPo7y_8AocI?si=ENFGQzl5cp0NlTiQ",
      "https://youtu.be/4ejfFIj5rrA?si=7pYbXAh8dPQKbC7t",
      "https://youtu.be/Hl9Zbg6cRTA?si=0LZfqz4p1uecnw74",
      "https://youtu.be/jvO3GJe_D3M?si=ICWK6FL0TOFFk_68",
      "https://youtu.be/VaTtYIosT_o?si=Di0yJoSi1eppHSF1",
      "https://youtu.be/N5rKUi-ducc?si=buIOyIoJ8P3ex8e9",
      "https://youtu.be/t5qLyuQ5_J4?si=0uenh0uk5f-UzIFm",
      "https://youtu.be/gl7b91v9nsk?si=a1pOU38m-5P958C_"
    ],
    "randomStart": true
  }
  </script>
</tistory-yt-audio-player>

<!-- ========================= -->
<!-- ğŸµ í”Œë ˆì´ì–´ ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ ì‹œì‘ -->
<!-- ========================= -->
<script>
(function(){
  // ----- Utils -----
  const fmt = s => { s=Math.max(0,s|0); const m=(s/60)|0, r=s%60; return m+":"+(r<10? "0"+r:r); };
  const extractId = url=>{
    let m = String(url).match(/youtu\.be\/([a-zA-Z0-9_-]{6,})/); if(m) return m[1];
    m = String(url).match(/[?&]v=([a-zA-Z0-9_-]{6,})/); if(m) return m[1];
    m = String(url).match(/^([a-zA-Z0-9_-]{6,})$/); return m?m[1]:null;
  };
  const waitForYT = () => new Promise(res=>{
    if (window.YT && YT.Player) return res();
    const poll = ()=> (window.YT && YT.Player) ? res() : setTimeout(poll, 80);
    if (!document.querySelector('script[data-yt-api]')) {
      const s = document.createElement('script');
      s.src = "https://www.youtube.com/iframe_api"; 
      s.setAttribute('data-yt-api','1'); 
      document.head.appendChild(s);
    }
    poll();
  });

  // Template & shadow DOM
  const tpl = document.createElement('template');
  tpl.innerHTML = `
  <style>
    :host{font-family:ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial;color:#fff;display:block}
    .card{background:linear-gradient(180deg,#0f0f12,#0b0b0d);border:1px solid #1e1e25;border-radius:18px;
      box-shadow:0 10px 30px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.04);overflow:hidden}
    .head{display:flex;gap:14px;align-items:center;padding:16px 18px;border-bottom:1px solid #191922}
    .disc{width:54px;height:54px;border-radius:50%;background:
      radial-gradient(60% 60% at 30% 30%,#3b3b44,transparent 60%),
      radial-gradient(60% 60% at 70% 70%,#1b1b22,transparent 60%),
      linear-gradient(135deg,#2a2a33,#16161b);
      box-shadow:inset 0 2px 10px rgba(0,0,0,.6), inset 0 0 1px rgba(255,255,255,.08);
      display:grid;place-items:center;font-size:20px}
    .spin{animation:spin 2.4s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .ttl{font-weight:700;font-size:16px;line-height:1.35}
    .sub{opacity:.8;font-size:12px}

    .bar{display:flex;align-items:center;gap:12px;flex-wrap:wrap;padding:14px 18px}

    /* Buttons */
    .btn{
      --c1:#2a2d3a; --c2:#13141a; --glow:#5569ff;
      position:relative; display:inline-flex; align-items:center; justify-content:center;
      width:46px; height:46px; border-radius:50%;
      border:1px solid #333644; color:#e6e8f5; font-size:18px; cursor:pointer;
      background:linear-gradient(145deg,var(--c1),var(--c2));
      box-shadow:
        0 4px 12px rgba(0,0,0,.5),
        inset 0 1px 2px rgba(255,255,255,.08),
        inset 0 -2px 4px rgba(0,0,0,.6);
      transition:all .25s ease;
      user-select:none;
    }
    .btn:hover{
      color:#fff; border-color:var(--glow);
      box-shadow:
        0 0 12px var(--glow),
        0 6px 18px rgba(0,0,0,.6),
        inset 0 1px 2px rgba(255,255,255,.12);
    }
    .btn:active{
      transform:scale(.92);
      box-shadow:
        0 2px 6px rgba(0,0,0,.6),
        inset 0 3px 6px rgba(0,0,0,.7),
        inset 0 0 6px var(--glow);
    }
    .btn.tog.on{
      background:linear-gradient(145deg,#3a4cff,#222555);
      border-color:#627aff; color:#fff;
      box-shadow:0 0 14px rgba(82,102,255,.8), inset 0 1px 2px rgba(255,255,255,.15);
    }
    .btn svg{width:18px;height:18px;display:block}

    /* Progress */
    .track{padding:0 18px 18px}
    .range{appearance:none;width:100%;height:8px;border-radius:999px;
      background:linear-gradient(90deg,#3a42a1 0%,#3a42a1 var(--pos,0%),#1a1b22 var(--pos,0%),#1a1b22 100%);
      outline:none;border:1px solid #2a2a33;box-shadow:inset 0 2px 6px rgba(0,0,0,.6), inset 0 1px 0 rgba(255,255,255,.03)}
    .range::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#fff,#b7c1ff 40%,#2d3cff 65%,#14163a 66%);
      box-shadow:0 4px 10px rgba(45,60,255,.35), inset 0 0 0 1px rgba(255,255,255,.35); border:none; margin-top:-5px}
    .time{display:flex;justify-content:space-between;font-size:11px;opacity:.85;margin-top:6px}

    /* Knob */
    .knobWrap{margin-left:auto;display:flex;align-items:center;gap:12px}
    .knob{--deg:0;width:56px;height:56px;border-radius:50%;
      background:conic-gradient(from 210deg,#2d3cff var(--fill,0%),#1a1b22 var(--fill,0%));
      position:relative;border:1px solid #2a2a33;cursor:pointer;
      box-shadow:inset 0 2px 10px rgba(0,0,0,.55), 0 10px 20px rgba(0,0,0,.35);
      transform:perspective(500px) rotateX(10deg)}
    .knob:before{content:"";position:absolute;inset:8px;border-radius:50%;
      background:radial-gradient(60% 60% at 30% 30%,#21212b,transparent 60%), linear-gradient(180deg,#262632,#15151b);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.04), inset 0 -1px 0 rgba(0,0,0,.6)}
    .knob:after{content:"";position:absolute;left:50%;top:50%;width:3px;height:14px;background:#e9ecff;border-radius:2px;transform-origin:50% 90%;
      transform: translate(-50%,-85%) rotate(calc(-140deg + var(--deg) * 1deg)); box-shadow:0 0 8px rgba(76,111,255,.6)}
    .kv{min-width:42px;font-size:12px;opacity:.9;text-align:right}
    .sr-only{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;backdrop-filter:blur(2px);z-index:99999}
    .overlay>div{background:linear-gradient(180deg,#101015,#0b0b10);border:1px solid #232334;color:#fff;
      padding:18px 20px;border-radius:16px;text-align:center;max-width:420px;box-shadow:0 10px 30px rgba(0,0,0,.5)}

    .invisible{position:absolute;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0;pointer-events:none}
  </style>
  <div class="card">
    <div class="head">
      <div class="disc" id="disc">ğŸµ</div>
      <div>
        <div class="ttl" id="ttl">ì¤€ë¹„ë¨</div>
        <div class="sub" id="sub">ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘</div>
      </div>
    </div>

    <div class="bar">
      <button class="btn" id="prevBtn" title="ì´ì „ê³¡" aria-label="ì´ì „ê³¡">
        <svg viewBox="0 0 24 24" fill="none"><path d="M7 6v12M18 6l-9 6 9 6V6z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>

      <button class="btn" id="playBtn" title="ì¬ìƒ/ì¼ì‹œì •ì§€" aria-label="ì¬ìƒ/ì¼ì‹œì •ì§€">â–¶</button>

      <button class="btn" id="nextBtn" title="ë‹¤ìŒê³¡" aria-label="ë‹¤ìŒê³¡">
        <svg viewBox="0 0 24 24" fill="none"><path d="M17 6v12M6 6l9 6-9 6V6z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>

      <button class="btn tog" id="shuffleBtn" title="ì…”í”Œ" aria-pressed="false">
        <svg viewBox="0 0 24 24" fill="none"><path d="M4 7h3l12 10M13 7l3-3m0 0v6m0-6h-6M4 17h3l3-2.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span class="sr-only">ì…”í”Œ</span>
      </button>

      <button class="btn tog" id="repeatBtn" title="í•œ ê³¡ ë°˜ë³µ" aria-pressed="false">
        <svg viewBox="0 0 24 24" fill="none"><path d="M7 7h7a4 4 0 014 4v1M17 17H10a4 4 0 01-4-4v-1M7 7l-2 2m0-2l2 2M17 17l2-2m0 2l-2-2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span class="sr-only">í•œ ê³¡ ë°˜ë³µ</span>
      </button>

      <div class="knobWrap" aria-label="ë³¼ë¥¨ ì¡°ì ˆ">
        <div class="knob" id="knob" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="80" aria-label="ë³¼ë¥¨"></div>
        <div class="kv"><span id="kv">80</span>%</div>
      </div>
    </div>

    <div class="track">
      <input type="range" id="seek" min="0" max="1000" value="0" class="range" aria-label="ì¬ìƒ ìœ„ì¹˜">
      <div class="time"><span id="cur">0:00</span><span id="dur">0:00</span></div>
    </div>
  </div>

  <div class="overlay" id="starter">
    <div>
      <div style="font-weight:700;font-size:16px;margin-bottom:6px">ìŒì•… í”Œë ˆì´ì–´</div>
      <div>ë¸Œë¼ìš°ì € ì •ì±… ë•Œë¬¸ì— ì²˜ìŒ í•œ ë²ˆì€ ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ ì†Œë¦¬ê°€ ì¬ìƒë¼ìš”.</div>
      <button class="btn" id="startBtn" style="margin-top:10px;width:120px;height:44px;border-radius:14px">â–¶ ì¬ìƒ ì‹œì‘</button>
      <div class="sr-only">ì‹œì‘ í›„ì—ëŠ” ê³¡ì´ ëë‚˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ê³¡ì´ ì¬ìƒë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <div class="invisible" id="ytMount"></div>
  `;

  class TistoryYTAudio extends HTMLElement{
    constructor(){ 
      super(); 
      this.attachShadow({mode:'open'}).appendChild(tpl.content.cloneNode(true)); 
    }

    connectedCallback(){
      let conf = {urls:[], randomStart:false};
      const script = this.querySelector('script[type="application/json"]');

      if (script) { 
        try{ conf = Object.assign(conf, JSON.parse(script.textContent.trim())); }catch(e){} 
      }

      this._ids = (conf.urls||[]).map(extractId).filter(Boolean);
      this._idx = conf.randomStart ? Math.floor(Math.random()*this._ids.length) : 0;
      this._duration = 0; 
      this._dragging=false; 
      this._shuffle=false; 
      this._repeat=false; 
      this._player=null;

      const $ = sel => this.shadowRoot.querySelector(sel);
      this.$disc=$('#disc'); 
      this.$ttl=$('#ttl'); 
      this.$sub=$('#sub');
      this.$play=$('#playBtn'); 
      this.$prev=$('#prevBtn'); 
      this.$next=$('#nextBtn');
      this.$shuf=$('#shuffleBtn'); 
      this.$rep=$('#repeatBtn');
      this.$seek=$('#seek'); 
      this.$cur=$('#cur'); 
      this.$dur=$('#dur');
      this.$st=$('#starter'); 
      this.$start=$('#startBtn');
      this.$knob=$('#knob'); 
      this.$kv=$('#kv'); 
      this.$mount=$('#ytMount');

      if (!this._ids.length){ 
        this.$ttl.textContent="ì¬ìƒ ë¶ˆê°€: ì˜¬ë°”ë¥¸ ìœ íŠœë¸Œ ì£¼ì†Œê°€ í•„ìš”í•©ë‹ˆë‹¤."; 
        return; 
      }

      this.$start.addEventListener('click', ()=>{
        try{ this._player && this._player.playVideo(); }catch(e){}
        this.$st.style.display='none'; 
        this.$disc.classList.add('spin'); 
        this.$play.textContent='â¸';
      }, {once:true});

      this.$play.addEventListener('click', ()=>{
        if (!this._player) return;
        const st = this._player.getPlayerState();
        if (st===YT.PlayerState.PLAYING) this._player.pauseVideo();
        else this._player.playVideo();
      });

      this.$prev.addEventListener('click', ()=> this._load(this._idx-1, true));
      this.$next.addEventListener('click', ()=> this._next(true));

      this.$shuf.addEventListener('click', (e)=>{
        this._shuffle=!this._shuffle; 
        e.currentTarget.classList.toggle('on', this._shuffle); 
        e.currentTarget.setAttribute('aria-pressed', String(this._shuffle));
      });

      this.$rep.addEventListener('click', (e)=>{
        this._repeat=!this._repeat; 
        e.currentTarget.classList.toggle('on', this._repeat);  
        e.currentTarget.setAttribute('aria-pressed', String(this._repeat)); 
      });

      const setSeekBg = v => this.$seek.style.setProperty('--pos', (v/10)+'%');

      this.$seek.addEventListener('input', ()=>{
        this._dragging=true; 
        setSeekBg(this.$seek.value); 
      });

      this.$seek.addEventListener('change', ()=>{
        this._dragging=false;
        const t = (this.$seek.value/1000) * this._duration;
        try{ this._player.seekTo(t, true); }catch(e){}
      });

      this._tick = setInterval(()=>{
        if (!this._player || this._dragging) return;
        try{
          this._duration = Math.floor(this._player.getDuration()||0);
          const cur = Math.floor(this._player.getCurrentTime()||0);
          if (this._duration>0){
            const v = Math.floor((cur/this._duration)*1000);
            this.$seek.value = v; 
            setSeekBg(v);
          }
          this.$cur.textContent = fmt(cur); 
          this.$dur.textContent = fmt(this._duration);
        }catch(e){}
      }, 250);

      this._initKnob();
      waitForYT().then(()=> this._createPlayer());
    }

    disconnectedCallback(){ 
      clearInterval(this._tick); 
    }

    _createPlayer(){
      this._player = new YT.Player(this.$mount, {
        width:1, height:1, 
        videoId: this._ids[this._idx],
        host:'https://www.youtube-nocookie.com',
        playerVars:{
          autoplay:0,
          controls:0,
          rel:0,
          iv_load_policy:3,
          modestbranding:1,
          playsinline:1,
          origin:location.origin
        },
        events:{
          onReady: ()=>{ this._afterLoadTitle(); },
          onStateChange: (ev)=>{
            const st = ev.data;
            if (st===YT.PlayerState.PLAYING){ 
              this.$play.textContent='â¸'; 
              this.$disc.classList.add('spin'); 
              this._afterLoadTitle(); 
            }
            else if (st===YT.PlayerState.PAUSED){ 
              this.$play.textContent='â–¶'; 
              this.$disc.classList.remove('spin'); 
            }
            else if (st===YT.PlayerState.ENDED){ 
              this._next(true); 
            }
          }
        }
      });
    }

    _afterLoadTitle(){
      setTimeout(()=>{
        try{
          const d = this._player.getVideoData();
          if (d && d.title){ 
            this.$ttl.textContent=d.title; 
            this.$sub.textContent="YouTube â€¢ ì˜¤ë””ì˜¤ ì „ìš©"; 
          }
        }catch(e){}
      }, 350);
    }

    _load(i, play){
      this._idx = (i + this._ids.length) % this._ids.length;
      this._player.loadVideoById(this._ids[this._idx]); 
      if (!play) this._player.pauseVideo();
      this._afterLoadTitle();
    }

    _next(){
      if (this._repeat) { 
        this._load(this._idx, true); 
        return; 
      }
      if (this._shuffle){
        let n = Math.floor(Math.random()*this._ids.length);
        if (this._ids.length>1 && n===this._idx) n=(n+1)%this._ids.length;
        this._load(n, true);
      } else {
        this._load(this._idx+1, true);
      }
    }

    _initKnob(){
      const knob=this.$knob, kv=this.$kv;
      let vol=80, dragging=false;

      const volToDeg = v => -140 + (v/100)*280;
      const degToVol = d => Math.min(100, Math.max(0, Math.round(((d + 140)/280)*100)));

      const render=()=>{
        const deg = volToDeg(vol);
        knob.style.setProperty('--deg', deg);
        knob.style.setProperty('--fill', vol+'%');
        kv.textContent=vol;
        knob.setAttribute('aria-valuenow', String(vol));
        try{ this._player && this._player.setVolume(vol|0); }catch(e){}
      };

      const angleFromEvent=(e)=>{
        const r=knob.getBoundingClientRect(), 
              cx=r.left+r.width/2, 
              cy=r.top+r.height/2;
        const x=(e.touches? e.touches[0].clientX : e.clientX)-cx;
        const y=(e.touches? e.touches[0].clientY : e.clientY)-cy;
        let ang=Math.atan2(y,x)*180/Math.PI; 
        ang+=90; 
        if(ang>180) ang-=360;
        return Math.max(-140, Math.min(140, ang));
      };

      const start=e=>{ 
        dragging=true; 
        e.preventDefault(); 
        vol=degToVol(angleFromEvent(e)); 
        render(); 
      };

      const move =e=>{ 
        if(!dragging) return; 
        e.preventDefault(); 
        vol=degToVol(angleFromEvent(e)); 
        render(); 
      };

      const end  =()=>{ dragging=false; };

      knob.addEventListener('mousedown', start);
      window.addEventListener('mousemove', move);
      window.addEventListener('mouseup', end);

      knob.addEventListener('touchstart', start, {passive:false});
      window.addEventListener('touchmove', move, {passive:false});
      window.addEventListener('touchend', end);

      knob.addEventListener('wheel', (e)=>{
        e.preventDefault(); 
        vol=Math.max(0, Math.min(100, vol+(e.deltaY>0?-3:3))); 
        render();
      }, {passive:false});

      knob.tabIndex=0;
      knob.addEventListener('keydown', (e)=>{
        if (e.key==='ArrowUp'||e.key==='ArrowRight'){ 
          vol=Math.min(100,vol+2); 
          render(); 
        }
        else if (e.key==='ArrowDown'||e.key==='ArrowLeft'){ 
          vol=Math.max(0,vol-2); 
          render(); 
        }
        else if (e.key==='Home'){ vol=0; render(); }
        else if (e.key==='End'){ vol=100; render(); }
      });

      render();
    }
  }

  if (!customElements.get('tistory-yt-audio-player')) {
    customElements.define('tistory-yt-audio-player', TistoryYTAudio);
  }
})();
</script>

</body>
</html>
